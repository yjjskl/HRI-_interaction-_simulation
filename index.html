<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRI Metadata</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* MUI Dark Theme Color Palette */
        :root {
            --mui-palette-background-default: #121212;
            --mui-palette-background-paper: #1e1e1e;
            --mui-palette-background-elevated: #2d2d2d;
            --mui-palette-primary-main: #90caf9;
            --mui-palette-primary-light: #e3f2fd;
            --mui-palette-primary-dark: #42a5f5;
            --mui-palette-secondary-main: #ce93d8;
            --mui-palette-success-main: #66bb6a;
            --mui-palette-warning-main: #ffa726;
            --mui-palette-error-main: #f44336;
            --mui-palette-info-main: #29b6f6;
            --mui-palette-text-primary: rgba(255, 255, 255, 0.87);
            --mui-palette-text-secondary: rgba(255, 255, 255, 0.6);
            --mui-palette-text-disabled: rgba(255, 255, 255, 0.38);
            --mui-palette-divider: rgba(255, 255, 255, 0.12);
            --mui-palette-action-hover: rgba(255, 255, 255, 0.08);
            --mui-palette-action-selected: rgba(255, 255, 255, 0.16);
            --mui-palette-action-focus: rgba(255, 255, 255, 0.12);
            /* Legacy variables for compatibility */
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-tertiary: #2d2d2d;
            --bg-card: #1e1e1e;
            --accent-cyan: #90caf9;
            --accent-purple: #ce93d8;
            --accent-orange: #ffa726;
            --accent-green: #66bb6a;
            --accent-yellow: #ffee58;
            --accent-red: #f44336;
            --accent-pink: #f48fb1;
            --accent-blue: #64b5f6;
            --text-primary: rgba(255, 255, 255, 0.87);
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-muted: rgba(255, 255, 255, 0.38);
            --border-color: rgba(255, 255, 255, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.5;
            letter-spacing: 0.00938em;
            background: var(--mui-palette-background-default);
            color: var(--mui-palette-text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app-container {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        /* MUI Drawer/Sidebar */
        .sidebar {
            background: var(--mui-palette-background-paper);
            border-right: 1px solid var(--mui-palette-divider);
            padding: 16px 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px 16px 16px;
            margin-bottom: 8px;
        }

        .logo-img {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            object-fit: contain;
        }

        .logo-text {
            font-weight: 500;
            font-size: 16px;
            color: var(--mui-palette-text-primary);
            letter-spacing: 0.15px;
        }

        /* MUI List Navigation */
        .nav-menu {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 0 8px;
        }

        .nav-item-group {
            display: flex;
            flex-direction: column;
        }

        .nav-menu-link {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 8px 16px;
            min-height: 48px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--mui-palette-text-secondary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 400;
            transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-menu-link:hover {
            background: var(--mui-palette-action-hover);
            color: var(--mui-palette-text-primary);
        }

        .nav-menu-link.active {
            background: rgba(144, 202, 249, 0.16);
            color: var(--mui-palette-primary-main);
        }

        .nav-menu-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
            color: inherit;
        }

        .nav-menu-link.active .nav-menu-icon {
            color: var(--mui-palette-primary-main);
        }

        /* Collapsible Nav Items */
        .nav-menu-link {
            position: relative;
        }

        .nav-menu-link .nav-arrow {
            margin-left: auto;
            font-size: 18px;
            transition: transform 200ms cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--mui-palette-text-disabled);
        }

        .nav-item-group.expanded .nav-menu-link .nav-arrow {
            transform: rotate(90deg);
        }

        /* Material Icons base styling */
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-smoothing: antialiased;
        }

        .nav-submenu {
            display: none;
            flex-direction: column;
            margin-top: 4px;
            padding-left: 24px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 200ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-item-group.expanded .nav-submenu {
            display: flex;
            max-height: 500px;
        }

        .nav-submenu-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            min-height: 40px;
            color: var(--mui-palette-text-secondary);
            text-decoration: none;
            font-size: 13px;
            border-radius: 8px;
            cursor: pointer;
            background: transparent;
            border: none;
            width: 100%;
            text-align: left;
            font-family: inherit;
            transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-submenu-link:hover {
            background: var(--mui-palette-action-hover);
            color: var(--mui-palette-text-primary);
        }

        .nav-submenu-link.active {
            background: rgba(144, 202, 249, 0.08);
            color: var(--mui-palette-primary-main);
        }

        .nav-submenu-icon {
            font-size: 20px;
        }

        .section-title {
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.08333em;
            color: var(--mui-palette-text-secondary);
            margin-bottom: 8px;
        }

        .example-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* MUI MenuItem */
        .example-btn {
            background: transparent;
            border: none;
            padding: 6px 16px;
            min-height: 48px;
            border-radius: 0;
            color: var(--mui-palette-text-primary);
            cursor: pointer;
            text-align: left;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            font-weight: 400;
            line-height: 1.5;
            letter-spacing: 0.00938em;
            transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 16px;
            width: 100%;
        }

        .example-btn:hover {
            background: var(--mui-palette-action-hover);
        }

        .example-btn.active {
            background: var(--mui-palette-action-selected);
            color: var(--mui-palette-primary-main);
        }

        .example-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .example-name {
            font-weight: 400;
            line-height: 1.5;
        }

        /* MUI Button + Menu */
        .examples-collapsible {
            margin-bottom: 24px;
        }

        .examples-toggle {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 6px 16px;
            min-height: 36px;
            background: transparent;
            border: 1px solid var(--mui-palette-divider);
            border-radius: 4px;
            cursor: pointer;
            color: var(--mui-palette-text-primary);
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.02857em;
            text-transform: uppercase;
            transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1), 
                        border-color 150ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        .examples-toggle:hover {
            background: var(--mui-palette-action-hover);
            border-color: var(--mui-palette-text-primary);
        }

        .examples-toggle .section-title {
            margin-bottom: 0;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.02857em;
            color: inherit;
        }

        .toggle-icon {
            font-size: 10px;
            color: inherit;
            transition: transform 200ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        .examples-collapsible.expanded .toggle-icon {
            transform: rotate(90deg);
        }

        /* MUI Paper/Menu Surface */
        .example-list-inline {
            display: none;
            flex-direction: column;
            margin-top: 8px;
            padding: 8px 0;
            background: var(--mui-palette-background-paper);
            border-radius: 4px;
            box-shadow: 0px 5px 5px -3px rgba(0,0,0,0.2),
                        0px 8px 10px 1px rgba(0,0,0,0.14),
                        0px 3px 14px 2px rgba(0,0,0,0.12);
            min-width: 280px;
            max-width: 400px;
        }

        .examples-collapsible.expanded .example-list-inline {
            display: flex;
        }

        .example-list-inline .example-btn {
            padding: 6px 16px;
            font-size: 16px;
            border-radius: 0;
        }

        .example-list-inline .example-icon {
            width: 24px;
            height: 24px;
            font-size: 20px;
        }

        /* MUI Chip-like Legend */
        .legend-inline {
            padding: 0;
            margin-bottom: 24px;
        }

        .legend-inline .section-title {
            margin-bottom: 12px;
        }

        .legend-items-inline {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .legend-item {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            font-size: 13px;
            font-weight: 400;
            color: var(--mui-palette-text-secondary);
            background: var(--mui-palette-action-hover);
            border-radius: 16px;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 420px;
            height: 100vh;
            overflow: hidden;
        }

        /* MUI Main Content Panel */
        .flowchart-panel {
            padding: 24px 32px;
            overflow-y: auto;
            background: var(--mui-palette-background-default);
        }

        .panel-header {
            margin-bottom: 24px;
        }

        .panel-title {
            font-size: 24px;
            font-weight: 400;
            line-height: 1.334;
            letter-spacing: 0;
            margin-bottom: 8px;
            color: var(--mui-palette-text-primary);
        }

        .panel-subtitle {
            color: var(--mui-palette-text-secondary);
            font-size: 14px;
            font-weight: 400;
            line-height: 1.43;
            letter-spacing: 0.01071em;
        }

        .situation-box {
            padding: 0;
            margin-bottom: 24px;
        }

        /* Content Area (Video + Timeline) */
        .content-area {
            display: flex;
            gap: 24px;
        }

        .content-area.has-video .timeline-wrapper {
            flex: 2;
        }

        .timeline-wrapper {
            flex: 1;
            min-width: 0;
        }

        /* Video Container */
        .video-container {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            display: none;
            flex-shrink: 0;
            width: 280px;
            position: sticky;
            top: 0;
            align-self: flex-start;
        }

        .video-container.has-video {
            display: block;
        }

        .video-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-purple);
            margin-bottom: 12px;
        }

        .video-player {
            width: 100%;
            border-radius: 8px;
            background: #000;
        }

        .situation-label {
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.08333em;
            color: var(--mui-palette-primary-main);
            margin-bottom: 8px;
        }

        .situation-text {
            color: var(--mui-palette-text-secondary);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 16px;
        }

        .transcript-box {
            background: var(--mui-palette-background-paper);
            border-left: 4px solid var(--mui-palette-secondary-main);
            padding: 16px;
            border-radius: 0 4px 4px 0;
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
            font-style: italic;
            color: var(--mui-palette-text-primary);
        }

        /* MUI Timeline */
        .timeline {
            position: relative;
            padding-left: 80px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 35px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--mui-palette-divider);
        }

        /* MUI Timeline Event Node */
        .event-node {
            position: relative;
            margin-bottom: 16px;
            cursor: pointer;
            transition: transform 150ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        .event-node:last-child {
            margin-bottom: 0;
        }

        .event-timestamp {
            position: absolute;
            left: -80px;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            text-align: right;
            font-family: 'Roboto Mono', monospace;
            font-size: 11px;
            color: var(--mui-palette-text-disabled);
        }

        .event-dot {
            position: absolute;
            left: -45px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--mui-palette-background-default);
            z-index: 1;
        }

        /* MUI Card */
        .event-card {
            background: var(--mui-palette-background-paper);
            border-radius: 4px;
            padding: 16px;
            transition: box-shadow 150ms cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0px 2px 1px -1px rgba(0,0,0,0.2),
                        0px 1px 1px 0px rgba(0,0,0,0.14),
                        0px 1px 3px 0px rgba(0,0,0,0.12);
        }

        .event-node:hover .event-card {
            box-shadow: 0px 3px 3px -2px rgba(0,0,0,0.2),
                        0px 3px 4px 0px rgba(0,0,0,0.14),
                        0px 1px 8px 0px rgba(0,0,0,0.12);
        }

        .event-node.active .event-card {
            box-shadow: 0px 5px 5px -3px rgba(0,0,0,0.2),
                        0px 8px 10px 1px rgba(0,0,0,0.14),
                        0px 3px 14px 2px rgba(0,0,0,0.12);
            outline: 2px solid var(--mui-palette-primary-main);
        }

        .event-node.active .event-dot {
            box-shadow: 0 0 0 4px rgba(144, 202, 249, 0.3);
        }

        .event-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        /* MUI Chip-like Badge */
        .event-type-badge {
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 0.02857em;
        }

        .event-title {
            font-weight: 500;
            font-size: 14px;
            flex: 1;
            color: var(--mui-palette-text-primary);
        }

        .event-description {
            color: var(--mui-palette-text-secondary);
            font-size: 14px;
            line-height: 1.43;
            letter-spacing: 0.01071em;
        }

        /* MUI Event Type Colors */
        .event-type-sensor .event-dot,
        .event-type-sensor .event-type-badge { background: #64b5f6; color: rgba(0,0,0,0.87); }
        
        .event-type-vision .event-dot,
        .event-type-vision .event-type-badge { background: #ce93d8; color: rgba(0,0,0,0.87); }
        
        .event-type-audio .event-dot,
        .event-type-audio .event-type-badge { background: #f48fb1; color: rgba(0,0,0,0.87); }
        
        .event-type-gesture .event-dot,
        .event-type-gesture .event-type-badge { background: #ffb74d; color: rgba(0,0,0,0.87); }
        
        .event-type-stt .event-dot,
        .event-type-stt .event-type-badge { background: #fff176; color: rgba(0,0,0,0.87); }
        
        .event-type-llm .event-dot,
        .event-type-llm .event-type-badge { background: #90caf9; color: rgba(0,0,0,0.87); }
        
        .event-type-grounding .event-dot,
        .event-type-grounding .event-type-badge { background: #80cbc4; color: rgba(0,0,0,0.87); }
        
        .event-type-planning .event-dot,
        .event-type-planning .event-type-badge { background: #b39ddb; color: rgba(0,0,0,0.87); }
        
        .event-type-decision .event-dot,
        .event-type-decision .event-type-badge { background: #ef9a9a; color: rgba(0,0,0,0.87); }
        
        .event-type-action .event-dot,
        .event-type-action .event-type-badge { background: #a5d6a7; color: rgba(0,0,0,0.87); }
        
        .event-type-tts .event-dot,
        .event-type-tts .event-type-badge { background: #80deea; color: rgba(0,0,0,0.87); }
        
        .event-type-response .event-dot,
        .event-type-response .event-type-badge { background: #80deea; color: rgba(0,0,0,0.87); }
        
        .event-type-learning .event-dot,
        .event-type-learning .event-type-badge { background: #81c784; color: rgba(0,0,0,0.87); }
        
        .event-type-waiting .event-dot,
        .event-type-waiting .event-type-badge { background: #bdbdbd; color: rgba(0,0,0,0.87); }
        
        .event-type-completion .event-dot,
        .event-type-completion .event-type-badge { background: #a5d6a7; color: rgba(0,0,0,0.87); }
        
        .event-type-context .event-dot,
        .event-type-context .event-type-badge { background: #e0e0e0; color: rgba(0,0,0,0.87); }

        /* MUI Metadata Panel */
        .metadata-panel {
            background: var(--mui-palette-background-paper);
            border-left: 1px solid var(--mui-palette-divider);
            padding: 24px;
            overflow-y: auto;
        }

        .metadata-header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--mui-palette-divider);
        }

        .metadata-event-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .metadata-timestamp {
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            color: var(--mui-palette-primary-main);
            background: rgba(144, 202, 249, 0.16);
            padding: 4px 12px;
            border-radius: 16px;
        }

        .metadata-title {
            font-size: 20px;
            font-weight: 500;
            line-height: 1.6;
            letter-spacing: 0.0075em;
            margin-bottom: 8px;
            color: var(--mui-palette-text-primary);
        }

        .metadata-description {
            font-size: 14px;
            color: var(--mui-palette-text-secondary);
            line-height: 1.43;
            letter-spacing: 0.01071em;
        }

        .metadata-section {
            margin-bottom: 24px;
        }

        .metadata-section-title {
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.08333em;
            color: var(--mui-palette-text-secondary);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--mui-palette-divider);
        }

        .metadata-section-title::before {
            display: none;
        }

        .metadata-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid var(--mui-palette-divider);
            gap: 16px;
        }

        .metadata-item:last-child {
            border-bottom: none;
        }

        .metadata-key {
            font-weight: 400;
            color: var(--mui-palette-text-secondary);
            font-size: 14px;
            flex-shrink: 0;
        }

        .metadata-key-note {
            display: block;
            font-size: 12px;
            color: var(--mui-palette-text-disabled);
            font-weight: 400;
            margin-top: 4px;
        }

        .metadata-value {
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            padding: 4px 12px;
            border-radius: 4px;
            background: var(--mui-palette-action-hover);
            color: var(--mui-palette-primary-main);
            text-align: right;
            word-break: break-word;
            max-width: 200px;
        }

        .metadata-value.updated {
            background: rgba(102, 187, 106, 0.16);
            color: var(--mui-palette-success-main);
            position: relative;
        }

        .metadata-value.updated::before {
            content: 'â†‘ ';
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--mui-palette-text-disabled);
            text-align: center;
            padding: 48px 24px;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.6;
        }

        .empty-state-text {
            font-size: 14px;
            line-height: 1.43;
            letter-spacing: 0.01071em;
            color: var(--mui-palette-text-secondary);
        }

        /* MUI-style Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--mui-palette-action-hover);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--mui-palette-action-focus);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <img src="HMND Logo.png" alt="HMND Logo" class="logo-img">
                <span class="logo-text">Home HRI Simulation</span>
            </div>

            <nav class="nav-menu">
                <div class="nav-item-group expanded" id="visualiserGroup">
                    <a href="index.html" class="nav-menu-link active" id="visualiserLink">
                        <span>Visualiser</span>
                        <span class="nav-arrow material-icons">chevron_right</span>
                    </a>
                    <div class="nav-submenu" id="exampleList">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                <div class="nav-item-group" id="docsGroup">
                    <a href="docs.html" class="nav-menu-link" id="docsLink">
                        <span>Documentation</span>
                        <span class="nav-arrow material-icons">chevron_right</span>
                    </a>
                </div>
            </nav>

        </aside>

        <main class="main-content">
            <div class="flowchart-panel">
                <div class="panel-header">
                    <h1 class="panel-title" id="exampleTitle">Loading...</h1>
                    <p class="panel-subtitle" id="exampleSubtitle"></p>
                </div>

                <div class="situation-box">
                    <div class="situation-label">Situation Context</div>
                    <p class="situation-text" id="situationText"></p>
                    <div class="transcript-box" id="transcriptText"></div>
                </div>

                <div class="legend-inline">
                    <div class="section-title">Event Types</div>
                    <div class="legend-items-inline">
                        <div class="legend-item">
                            <span class="legend-dot" style="background: var(--accent-blue);"></span>
                            <span>Sensor</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: var(--accent-purple);"></span>
                            <span>Vision</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: var(--accent-pink);"></span>
                            <span>Audio</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: var(--accent-yellow);"></span>
                            <span>Speech-to-Text</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: var(--accent-cyan);"></span>
                            <span>LLM Processing</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: var(--accent-green);"></span>
                            <span>Action (Voice, sound effect, display, gesture)</span>
                        </div>
                    </div>
                </div>

                <div class="content-area" id="contentArea">
                    <div class="video-container" id="videoContainer">
                        <div class="video-label">Reference Video</div>
                        <video class="video-player" id="videoPlayer" controls>
                            <source id="videoSource" src="" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>

                    <div class="timeline-wrapper">
                        <div class="timeline" id="timeline">
                        </div>
                    </div>
                </div>
            </div>

            <div class="metadata-panel">
                <div id="metadataContent">
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ‘†</div>
                        <p class="empty-state-text">Select an event in the timeline to view its metadata state</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Load workflow data -->
    <script src="workflows.js"></script>
    
    <script>
        let currentWorkflowId = 1;
        let selectedEventId = null;

        const exampleIcons = ['pan_tool', 'checkroom', 'lock', 'help_outline', 'weekend'];
        
        // Video files for each workflow (null if no video)
        const workflowVideos = {
            1: 'Robot_Scratches_Woman_s_Itchy_Nose.mp4',
            2: 'Robot_Fulfills_Coat_Hanging_Request.mp4',
            3: 'Robot_Respects_Privacy_During_Call.mp4',
            4: 'Robot_ask_unidentifiedObject.mp4',
            5: null
        };

        function initializeApp() {
            renderExampleList();
            renderWorkflow(currentWorkflowId);
            setupNavToggle();
        }

        function setupNavToggle() {
            // Toggle Visualiser submenu
            const visualiserLink = document.getElementById('visualiserLink');
            const visualiserGroup = document.getElementById('visualiserGroup');
            
            visualiserLink.addEventListener('click', (e) => {
                e.preventDefault();
                visualiserGroup.classList.toggle('expanded');
            });

            // Toggle Documentation submenu (if on docs page, this would be handled there)
            const docsLink = document.getElementById('docsLink');
            const docsGroup = document.getElementById('docsGroup');
            
            docsLink.addEventListener('click', (e) => {
                // Navigate to docs page
                window.location.href = 'docs.html';
            });
        }

        function renderExampleList() {
            const container = document.getElementById('exampleList');
            container.innerHTML = workflowData.map((workflow, index) => `
                <button class="nav-submenu-link ${workflow.id === currentWorkflowId ? 'active' : ''}" data-id="${workflow.id}">
                    <span>${workflow.title.replace(/"/g, '')}</span>
                </button>
            `).join('');

            container.querySelectorAll('.nav-submenu-link').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.nav-submenu-link').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentWorkflowId = parseInt(btn.dataset.id);
                    selectedEventId = null;
                    renderWorkflow(currentWorkflowId);
                    renderEmptyState();
                });
            });
        }

        function renderWorkflow(workflowId) {
            const workflow = workflowData.find(w => w.id === workflowId);
            if (!workflow) return;

            // Update header
            document.getElementById('exampleTitle').textContent = workflow.title;
            document.getElementById('exampleSubtitle').textContent = workflow.subtitle;
            document.getElementById('situationText').textContent = workflow.situation;
            document.getElementById('transcriptText').textContent = workflow.transcript;

            // Update video
            const contentArea = document.getElementById('contentArea');
            const videoContainer = document.getElementById('videoContainer');
            const videoSource = document.getElementById('videoSource');
            const videoPlayer = document.getElementById('videoPlayer');
            const videoFile = workflowVideos[workflowId];
            
            if (videoFile) {
                videoSource.src = videoFile;
                videoPlayer.load();
                videoContainer.classList.add('has-video');
                contentArea.classList.add('has-video');
            } else {
                videoContainer.classList.remove('has-video');
                contentArea.classList.remove('has-video');
                videoSource.src = '';
            }

            // Render timeline
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = workflow.events.map(event => `
                <div class="event-node event-type-${event.eventType}" data-event-id="${event.id}">
                    <div class="event-timestamp">${event.timestamp}</div>
                    <div class="event-dot"></div>
                    <div class="event-card">
                        <div class="event-header">
                            <span class="event-type-badge">${formatEventType(event.eventType)}</span>
                            <span class="event-title">${event.title}</span>
                        </div>
                        <div class="event-description">${event.description}</div>
                    </div>
                </div>
            `).join('');

            // Add click handlers
            timeline.querySelectorAll('.event-node').forEach(node => {
                node.addEventListener('click', () => {
                    document.querySelectorAll('.event-node').forEach(n => n.classList.remove('active'));
                    node.classList.add('active');
                    selectedEventId = node.dataset.eventId;
                    
                    const event = workflow.events.find(e => e.id === selectedEventId);
                    if (event) {
                        renderMetadata(event, workflow);
                    }
                });
            });
        }

        function formatEventType(type) {
            const typeMap = {
                'sensor': 'Sensor',
                'vision': 'Vision',
                'audio': 'Audio',
                'gesture': 'Gesture',
                'stt': 'STT',
                'llm': 'LLM',
                'grounding': 'Grounding',
                'planning': 'Planning',
                'decision': 'Decision',
                'action': 'Action',
                'tts': 'TTS',
                'response': 'Response',
                'learning': 'Learning',
                'waiting': 'Waiting',
                'completion': 'Complete',
                'context': 'Context'
            };
            return typeMap[type] || type;
        }

        function renderMetadata(event, workflow) {
            const container = document.getElementById('metadataContent');
            
            // Build accumulated metadata up to this event
            const eventIndex = workflow.events.findIndex(e => e.id === event.id);
            const accumulatedMetadata = buildAccumulatedMetadata(workflow.events.slice(0, eventIndex + 1));
            
            let html = `
                <div class="metadata-header">
                    <div class="metadata-event-info">
                        <span class="metadata-timestamp">${event.timestamp}</span>
                        <span class="event-type-badge event-type-${event.eventType}" style="font-size: 11px;">${formatEventType(event.eventType)}</span>
                    </div>
                    <h2 class="metadata-title">${event.title}</h2>
                    <p class="metadata-description">${event.description}</p>
                </div>
            `;

            // Universal Metadata Section
            if (Object.keys(accumulatedMetadata.universal).length > 0) {
                html += `
                    <div class="metadata-section">
                        <div class="metadata-section-title">Universal Interaction Metadata</div>
                `;
                
                for (const [key, data] of Object.entries(accumulatedMetadata.universal)) {
                    const isUpdatedThisEvent = event.metadata.universal && 
                        event.metadata.universal[key] && 
                        event.metadata.universal[key].updated;
                    
                    html += `
                        <div class="metadata-item">
                            <div class="metadata-key">
                                ${key}
                                ${data.note ? `<span class="metadata-key-note">${data.note}</span>` : ''}
                            </div>
                            <div class="metadata-value ${isUpdatedThisEvent ? 'updated' : ''}">${data.value}</div>
                        </div>
                    `;
                }
                
                html += `</div>`;
            }

            // Specific Metadata Section
            if (Object.keys(accumulatedMetadata.specific).length > 0) {
                html += `
                    <div class="metadata-section">
                        <div class="metadata-section-title">Interaction-Specific Metadata</div>
                `;
                
                for (const [key, data] of Object.entries(accumulatedMetadata.specific)) {
                    const isUpdatedThisEvent = event.metadata.specific && 
                        event.metadata.specific[key] && 
                        event.metadata.specific[key].updated;
                    
                    html += `
                        <div class="metadata-item">
                            <div class="metadata-key">
                                ${formatMetadataKey(key)}
                                ${data.note ? `<span class="metadata-key-note">${data.note}</span>` : ''}
                            </div>
                            <div class="metadata-value ${isUpdatedThisEvent ? 'updated' : ''}">${data.value}</div>
                        </div>
                    `;
                }
                
                html += `</div>`;
            }

            container.innerHTML = html;
        }

        function buildAccumulatedMetadata(eventsUpToNow) {
            const accumulated = {
                universal: {},
                specific: {}
            };

            for (const event of eventsUpToNow) {
                // Merge universal metadata
                if (event.metadata.universal) {
                    for (const [key, value] of Object.entries(event.metadata.universal)) {
                        accumulated.universal[key] = { ...value };
                    }
                }
                
                // Merge specific metadata
                if (event.metadata.specific) {
                    for (const [key, value] of Object.entries(event.metadata.specific)) {
                        accumulated.specific[key] = { ...value };
                    }
                }
            }

            return accumulated;
        }

        function formatMetadataKey(key) {
            return key.replace(/_/g, ' ').replace(/([A-Z])/g, ' $1').trim();
        }

        function renderEmptyState() {
            const container = document.getElementById('metadataContent');
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ðŸ‘†</div>
                    <p class="empty-state-text">Select an event in the timeline to view its metadata state</p>
                </div>
            `;
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
